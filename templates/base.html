{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}School Management{% endblock %}</title>
    {% tailwind_css %}
    
    <!-- Prevent dark mode flash -->
    <script>
        // Check dark mode preference before page renders
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }
    </script>
    
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        
        /* Smooth transitions for dark mode - ONLY on body and containers */
        body, 
        body > div,
        aside,
        header,
        main,
        .rounded-lg,
        .border {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        
        /* Prevent transition on page load */
        .preload,
        .preload * {
            transition: none !important;
        }
        
        /* HTMX loading indicator */
        .htmx-indicator {
            display: none;
            z-index: 9999;
        }
        .htmx-request .htmx-indicator {
            display: block;
        }
        .htmx-request.htmx-indicator {
            display: block;
        }
        
        /* Smooth content swap */
        #main-content {
            transition: opacity 0.2s ease;
        }
        .htmx-swapping #main-content {
            opacity: 0.5;
        }
    </style>
</head>
<body 
    x-data="{ darkMode: false, sidebarToggle: false }"
    x-init="
        darkMode = localStorage.getItem('darkMode') === 'true';
        $watch('darkMode', value => localStorage.setItem('darkMode', value));
        setTimeout(() => document.body.classList.remove('preload'), 100);
    "
    :class="{'dark': darkMode}"
    class="preload bg-white dark:bg-gray-900"
>
    <div class="flex h-screen overflow-hidden">
        {% include 'partials/sidebar.html' %}
        
        <div class="relative flex flex-1 flex-col overflow-y-auto">
            <!-- Mobile Overlay -->
            <div 
                x-show="sidebarToggle" 
                @click="sidebarToggle = false"
                x-transition
                class="fixed inset-0 z-40 bg-black/50 lg:hidden"
                x-cloak
            ></div>

            {% include 'partials/header.html' %}
            
            <main class="relative flex-1 p-6">
                <!-- Loading Indicator -->
                <div id="loading-indicator" class="htmx-indicator absolute inset-0 z-50 flex items-center justify-center bg-white/80 dark:bg-gray-900/80">
                    <div class="flex flex-col items-center gap-3">
                        <svg class="h-12 w-12 animate-spin text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Loading...</span>
                    </div>
                </div>
                
                <div id="main-content">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>
</body>
</html>